#include "sort_papers.h"
#include <stdlib.h>
#include <stdio.h>
void PrintList(int* arr, int length);


void sort_papers(int n, int *p) {
    int count = 0;
    char* locations = (char*)malloc((n+1)*sizeof(char));
    int* A = (int*)malloc(n*sizeof(int));
    int topA = n;
    int* B = (int*)malloc(n*sizeof(int));
    int topB = 0;
    int* C = (int*)malloc(n*sizeof(int));
    int topC = 0;
    for (int i = 0; i < n; i++){
        A[i] = p[n-1-i];
        locations[i+1] = 'A';
    }
    /*printf("P: ");
    PrintList(A, n);
    PrintList(A, topA);
    PrintList(B, topB);
    PrintList(C, topC);*/

    for (int i = 1; i <= n; i++) {
        /*printf("SEARCH FOR: %d\n", i);*/
        if (locations[i] == 'A') {
            while (A[topA-1] != i) {
                //move(STACK_A, STACK_C);
                count++;
                C[topC++] = A[--topA];
                locations[C[topC-1]] = 'C';
                /*printf("A: "); PrintList(A, topA);
                printf("B: "); PrintList(B, topB);
                printf("C: "); PrintList(C, topC);*/
            }
            //move(STACK_A, STACK_B);
            count++;
            B[topB++] = A[--topA];
            locations[B[topB-1]] = 'B';
            /*printf("B\n");
            printf("A: "); PrintList(A, topA);
            printf("B: "); PrintList(B, topB);
            printf("C: "); PrintList(C, topC);*/
        } else if (locations[i] == 'C') {
            while (C[topC-1] != i) {
                //move(STACK_C, STACK_A);
                count++;
                A[topA++] = C[--topC];
                locations[A[topA-1]] = 'A';
                /*printf("A: "); PrintList(A, topA);
                printf("B: "); PrintList(B, topB);
                printf("C: "); PrintList(C, topC);*/
            }
            //move(STACK_C, STACK_B);
            count++;
            B[topB++] = C[--topC];
            locations[B[topB-1]] = 'B';
            /*printf("A: "); PrintList(A, topA);
            printf("B: "); PrintList(B, topB);
            printf("C: "); PrintList(C, topC);*/
        }
    }

    for (int i = 0; i < n; i++) {
        //move(STACK_B, STACK_A);
        count++;
        A[topA++] = B[--topB];
        locations[A[topA-1]] = 'A';
    }
    PrintList(A, n);
    printf("COUNT: %d\n", count);
}

int main() {

    int* p16A = (int*)malloc(16*sizeof(int));
    for (int i = 1; i <= 16; i++) {
        p16A[i-1] = i;
    }
    sort_papers(16, p16A);
    
    int* p16B = (int*)malloc(16*sizeof(int));
    for (int i = 16; i > 0; i--) {
        p16B[16-i] = i;
    }
    sort_papers(16, p16B);

    int p16C[16] = {4,14,1,6,12,2,13,7,9,11,15,16,10,3,5,8};
    sort_papers(16, p16C);

    int p365A[365] = {
        243, 254, 246,   6, 283,  70, 212, 284,  44, 170, 236, 103,  75,
       336, 225, 308, 360,  64, 179,  55, 207, 343, 238, 242, 137, 150,
       352,  11, 269, 277, 311, 261, 134, 260, 138, 239, 125, 231, 141,
       348, 126, 355, 156,  19, 195, 121, 298, 184, 302,  88,  25, 151,
       136, 292,  92, 222, 188, 158, 304,  87, 148,  83,  90, 152, 169,
       182, 123, 185, 140, 226, 223, 227, 328, 316, 157, 130, 228,  81,
       280, 186, 273, 147,  85, 266, 205,  93,  82,  38, 221, 290, 165,
       331,  13, 208,   3, 194, 102, 245, 201, 351,  40,  22,  77,  28,
        76, 313, 198, 270,   5, 300,  95, 187, 318, 329, 106, 279,  35,
       229, 107, 118, 297,  15,  37, 275,  16, 216,  97, 111,  73, 127,
       167, 131, 288, 341, 161,  51, 301, 114, 219, 214, 282, 119, 264,
        58, 200, 132,  54, 190,   4, 117, 202, 100, 253, 174,  99, 144,
       306,  49, 160,  65, 344, 325, 171,  47,  36,  61, 303,  98, 310,
       327, 163, 193,  17, 241,  56,  39, 124,  34, 289, 168, 295, 209,
         9,  26, 218, 172,  62,  94, 183, 197, 361, 128, 256, 267, 175,
        68,  20, 145, 294, 286, 323, 244, 113, 271, 293, 159, 291,  29,
       287, 363,  63, 255,  59, 347, 322,  69, 321, 166, 333,  84, 164,
       196,  91,   8, 206, 317,  96, 217, 357, 276, 320, 232, 101,  71,
        27, 334, 189, 312, 234, 143, 339, 181,  45, 178, 192, 349,  79,
       177, 358, 350, 345, 173,  43, 153, 155, 268, 278, 230, 251, 257,
        48, 353, 356, 262, 285, 233, 259,  12,  21, 247, 116, 281,  60,
       309, 146, 199, 354,  30, 240, 365,  74, 263,  67, 248, 337,  80,
       252, 307, 213,  41, 315, 139,  42, 180,  53,  57,  66, 109, 135,
        24, 191, 133,  86,   7,  72, 162, 265, 305, 108, 129, 224, 237,
        18, 122, 319, 330, 340, 346,  14,  78, 203, 105, 120, 249, 326,
         1, 274, 362,  50, 176, 112,  33, 142, 338, 364, 250, 104,   2,
       204, 342, 258,  23, 210,  46, 272, 314, 299, 332, 115,  89, 296,
       110, 154, 335,  10, 149, 359,  52, 235, 211, 220, 324, 215,  31,
        32
    };
    sort_papers(365, p365A);
    int p365B[365] = {
        253, 72, 65, 281, 240, 321, 228, 287, 279, 119, 79, 37, 209, 167, 231, 151, 90, 11, 25, 24, 336, 157, 34, 120, 260, 113, 92, 85, 224, 105, 6, 109, 247, 29, 73, 264, 298, 259, 187, 189, 207, 36, 180, 5, 283, 353, 272, 144, 117, 83, 137, 155, 121, 13, 64, 43, 248, 150, 75, 112, 169, 123, 18, 270, 15, 170, 74, 35, 8, 294, 53, 89, 362, 296, 197, 2, 146, 244, 159, 249, 62, 316, 176, 313, 132, 306, 168, 233, 93, 174, 98, 309, 346, 22, 360, 350, 222, 213, 347, 225, 135, 178, 9, 274, 60, 331, 158, 95, 80, 337, 182, 276, 20, 51, 104, 78, 343, 58, 59, 236, 39, 317, 312, 10, 261, 154, 91, 206, 211, 46, 214, 355, 87, 358, 101, 256, 255, 291, 342, 162, 333, 14, 238, 69, 227, 250, 33, 265, 246, 335, 145, 282, 215, 4, 262, 226, 273, 356, 267, 111, 303, 220, 125, 96, 229, 218, 133, 156, 199, 19, 139, 319, 219, 21, 242, 299, 38, 84, 278, 290, 314, 254, 148, 198, 23, 286, 86, 354, 130, 329, 340, 99, 315, 239, 204, 52, 183, 365, 118, 28, 292, 310, 318, 173, 61, 263, 45, 185, 166, 364, 134, 269, 100, 42, 305, 177, 160, 32, 327, 50, 363, 280, 94, 345, 107, 202, 341, 196, 54, 71, 308, 326, 149, 181, 131, 200, 27, 30, 110, 302, 48, 258, 140, 16, 165, 175, 330, 325, 129, 268, 44, 126, 357, 128, 217, 147, 352, 97, 245, 179, 221, 235, 41, 339, 143, 122, 1, 114, 17, 81, 359, 307, 115, 186, 31, 266, 49, 271, 12, 323, 55, 194, 344, 203, 142, 153, 301, 293, 328, 164, 288, 311, 57, 67, 191, 192, 106, 77, 216, 230, 88, 205, 66, 108, 322, 141, 243, 102, 304, 257, 223, 7, 324, 300, 289, 70, 190, 47, 334, 172, 332, 252, 152, 295, 171, 103, 193, 201, 40, 348, 163, 241, 361, 232, 277, 3, 251, 208, 184, 136, 127, 297, 284, 63, 138, 320, 82, 275, 285, 188, 351, 210, 195, 116, 56, 212, 68, 234, 338, 349, 161, 76, 124, 26, 237
    };
    sort_papers(365, p365B);

    int p56A[56] = {
        39, 15, 46, 45, 27, 1, 11, 26, 34, 6, 22, 36, 49, 55, 10, 31, 5, 53, 17, 3, 2, 19, 35, 14, 9, 25, 50, 43, 40, 8, 24, 32, 4, 20, 38, 41, 12, 44, 21, 56, 16, 51, 33, 47, 48, 23, 37, 29, 42, 13, 28, 30, 18, 7, 54, 52
    };
    sort_papers(56, p56A);
}